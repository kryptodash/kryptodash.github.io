(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{73:function(e,t,i){"use strict";var n,a;
/*!
 * Datapine
 * This is a special set of models and collections that parse and prepare the chart config
 * Copyright(c) 2012
 */n=[i(405),i(3),i(2),i(9),i(23),i(192)],void 0===(a=function(e,t,i,n,a,s){var o={"data.type":"generationConfig.type","data.backupType":"generationConfig.backupType","data.joinType":"generationConfig.joinType","data.stickyDimensions":"generationConfig.stickyDimensions","data.SQLBox":"generationConfig.SQLBox","data.downsampling":"generationConfig.downsampling","data.MDXBox":"generationConfig.MDXBox","data.geocoding":"generationConfig.geocoding","data.geocodeType":"generationConfig.geocodeType","data.switchColumnsRows":"generationConfig.switchColumnsRows","data.activeTimeFields":"generationConfig.activeTimeFields","data.aggregateRowAggregationType":"generationConfig.aggregateRowAggregationType","data.filters":"generationConfig.filters","data.segments":"generationConfig.segments","data.measures":"generationConfig.measures","data.dimensions":"generationConfig.dimensions","data.groups":"generationConfig.groups"},r=["generationConfig.type","generationConfig.autoType","generationConfig.backupType","generationConfig.joinType","generationConfig.stickyDimensions","generationConfig.SQLBox","generationConfig.downsampling","generationConfig.MDXBox","generationConfig.geocoding","generationConfig.geocodeType","generationConfig.switchColumnsRows","generationConfig.activeTimeFields","generationConfig.aggregateRowAggregationType","generationConfig.previousConfig","data.comments","data.accumulation","data.seriesOrderDecompose","data.seriesOrder","data.seriesOrderApplied","data.categoriesOrder","data.series","data.categoriesOrderApplied","data.order","data.YAxis","data.YAxis2","data.XAxis","data.showNameLabels","data.showDatalabels","data.showDatalabelsPercentage","data.previousPeriodPercentage","data.previousPeriodAbsolute","data.showTrendIndicator","data.suffix","data.prefix","data.showThousandSeperator","data.borderColor","data.gridlineColor","data.chartFont","data.numberFormat","data.showNulls","data.numberDecimal","data.numberSymbol","data.selectedField","data.decimalPlaces","data.fontSize","data.targetType","data.targetValue","data.displayYAxis","data.displayXAxis","data.displayTrendline","data.displayTrendLegend","data.isStacked","data.startAxisAtZero","data.displayTrendslope","data.displayTrendfit","data.showDatalabelsPercentage","data.stacking","data.displayTotallabel","data.showDataLabelsInside","data.backgroundColor","data.legend","data.titleTextStyle","data.titlePosition","data.fontName","data.animation","data.seriesColors","data.dataLabelStyle","data.chartOptions","commonConfig.useAsFilter","data.conditionalChart","data.pivottable","data.gaugeOptions","data.columns","data.mapStyle","data.isLackingDate","commonConfig.isDynamicTimeAggregation","data.isZoomActive","data.actAsLink","data.textAsLink","data.drilldown","data.isPieDonut","data.filterDateFormat","commonConfig.conditionalformatting","commonConfig.tableConditionalFormatting","commonConfig.forecastConfig","data.style"],l={isHidden:!1,fontFamily:"Arial",fontRelativeSize:"small",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",color:"#666"},d=function(e,t,i){i||(i=["tableName","columnName"]);var n=_.compact([e.get("columnId"),e.get("id"),e.get("feId")]),a=_.compact([t.get("columnId"),t.get("id"),t.get("feId")]),s=_.intersection(n,a).length>0,o=_.every(i,(function(i){var n=e.get(i);return n&&n===t.get(i)}));return s||o};return Backbone.NestedModel.extend({toTranslate:e,urlRoot:"/chart",constructor:function(){this.defaults=_.result(this,"dynamicDefaults")||this.defaults,Backbone.Model.apply(this,arguments)},dynamicDefaults:function(){return{actAsLink:{},name:e.chartTitleDefault,width:377,height:288,isDirty:!1,data:{accumulation:!1,seriesOrder:[],seriesOrderApplied:!1,categoriesOrder:[],categoriesOrderApplied:!1,showNulls:!1,displayYAxis:!0,displayXAxis:!1,gridlineColor:"#EEEEEE",YAxis:{color:"#666",title:{style:{color:"#666",fontWeight:"bold",fontStyle:"normal",fontSize:"12px",textDecoration:"normal"}},labels:{enabled:!0,style:{color:"#666",fontWeight:"normal",fontStyle:"normal",fontSize:"12px",textDecoration:"normal"}},displayAxisLabel:!0,numberSymbol:"",numberDecimal:"auto",axisUnit:"auto",reversedStacks:!1,numberFormat:i.get("organizationConfig.numberFormat")},YAxis2:{color:"#666",title:{style:{color:"#666",fontWeight:"bold",fontStyle:"normal",fontSize:"12px",textDecoration:"normal"}},labels:{enabled:!0,style:{color:"#666",fontWeight:"normal",fontStyle:"normal",fontSize:"12px",textDecoration:"normal"}},displayAxisLabel:!0,numberSymbol:"none",numberDecimal:"auto",axisUnit:"auto",reversedStacks:!1,numberFormat:i.get("organizationConfig.numberFormat")},XAxis:{color:"#666",title:{style:{color:"#666",fontWeight:"bold",fontStyle:"normal",fontSize:"12px",textDecoration:"normal"}},labels:{enabled:!0,maxStaggerLines:1,style:{color:"#666",fontWeight:"normal",fontStyle:"normal",fontSize:"12px"}},numberSymbol:"none",numberDecimal:"auto",numberFormat:i.get("organizationConfig.numberFormat")},pivottable:{columns:{add:[],remove:[],borderColor:"#edf3f8",columnBackground:"#ffffff",alternativeRowColor:"#f9fcfe",fontColor:"#27353f",fontFamily:"Arial",fontSize:"12px",rowHeight:"16px",borderStyle:"all",allowTextWrap:!1,transposeTable:!1,fontWeight:"normal",fontStyle:"normal",textDecoration:"normal",alignment:"auto",decimalPlaces:"auto",numberSymbol:"",alternativeRowSelect:"custom",cellColorGradientStart:"#f9fcfe",cellColorGradientEnd:"#359fe5"},columnHeader:{enabled:!0,style:{fontColor:"#27353f",fontSize:"12px",fontFamily:"Arial",fontWeight:"bold",fontStyle:"normal",columnBackground:"#f2f7fa",alignment:"center",textDecoration:"normal"}},totalRow:{enabled:!1,style:{fontColor:"#27353f",fontSize:"12px",fontFamily:"Arial",fontWeight:"bold",fontStyle:"normal",columnBackground:"#f2f7fa",textDecoration:"normal"},label:e.js_96b0141273eabab320119c467cdcaf17,disableLabel:!1,resultRow:"sum"},totalColumn:{enabled:!1,style:{fontColor:"#27353f",fontSize:"12px",fontFamily:"Arial",fontWeight:"bold",fontStyle:"normal",columnBackground:"#f2f7fa",textDecoration:"normal"}}},legend:{itemStyle:{fontSize:"12px",color:"#666",fontWeight:"normal",fontStyle:"normal",textDecoration:"normal"},position:"auto",enabled:!0},title:l,style:{title:l,strokeColor:"#ffffff",boxShadowAngle:"0",boxShadowShape:"Square",boxShadowStroke:"None",borderStroke:"None",boxShadowColor:"#ffffff",borderStyle:"solid",numberUnit:"auto",showUnitSuffix:!0},mapStyle:{type:"map"},chartOptions:{itemStyle:{fontSize:"12px",color:"#666",fontWeight:"normal",fontStyle:"normal",textDecoration:"normal"},totalOptions:{itemStyle:{fontSize:"12px",color:"#666"}}},chartFont:{fontFamily:"Arial",fontSize:"14px"},fontSize:"auto",decimalPlaces:"0",numberFormat:i.get("organizationConfig.numberFormat")},isDrilldown:!1,generationConfig:{stickyDimensions:!1,downsampling:{threshold:200},joinType:"INNER",type:t.defaultChartType,autoType:"A"!==a.channel.user.request(a.channel.user.message.get.testing.group.chartHelper),previousConfig:{enabled:!1,type:"PREVIOUS_PERIOD"}}}},initialize:function(e,t){(t=t||{}).gizmoModel&&(this.gizmoModel=t.gizmoModel),this.payloadOptions={mobile:this.mobile=!!t.mobile},this.isNew()&&(this.set("data.version",1),this.get("data.seriesColors")&&this.get("data.seriesColors")[0].seriesColor||this._setSeriesColors(),this.set("data.style.title.fontSizeNormalized",!0),this.set("data.style.title.fontRelativeSize","small"),this.unset("data.style.title.fontSize")),this.useAsFilterConst="commonConfig.useAsFilter",this.initFields(),this.sortDir=0},initFields:function(){this.fields||(this.fields=new s,this.fields.chart=this)},parse:function(e){var t,i,n;if(e=_.deepClone(e),this.initFields(),this.fields.reset(),i=this,t=[],e.data=(_.isString(e.data)?JSON.parse(e.data):e.data)||{},e.style=(_.isString(e.style)?JSON.parse(e.style):e.style)||{},e.generationConfig=(_.isString(e.generationConfig)?JSON.parse(e.generationConfig):e.generationConfig)||{},a.channel.app.request("get:exportMode:isTable")?e.generationConfig.type="table":!a.channel.app.request("get:isExportMode")&&e.generationConfig.backupType&&"table"!==e.generationConfig.backupType&&(e.generationConfig.type=e.generationConfig.backupType),delete e.data.backupType,delete e.generationConfig.backupType,delete e.data.dynamicTimeAggregation,!_.isEmpty(e.style)&&_.isEmpty(e.data)&&(e.data=e.style,delete e.style),_.isEmpty(e.generationConfig)&&_.each(o,(function(t,i){_.deep(e,t,_.deep(e,i))})),e.type&&(e.generationConfig.type||(e.generationConfig.type=e.type),delete e.type),e.data.name&&this.set("name",e.data.name),e.generationConfig&&(_.each(e.generationConfig.dimensions,(function(e){e.origin="dimensions",e.edit=!1,this.fields.add(e,{parse:!0})}),this),_.each(e.generationConfig.measures,(function(e){e.origin="measures",e.edit=!1,this.fields.add(e,{parse:!0})}),this),_.each(e.generationConfig.filters,(function(e){var t;e.origin="filters",e.edit=!1,"ga:allSegments"===e.id?(t=i.convertSegmentFilterToAnalyticsFilter(e),this.fields.add(t,{parse:!0})):"metrics"!==e.linked&&this.fields.add(e,{parse:!0})}),this),_.each(e.generationConfig.segments,(function(e){t.push(e)}),this),(!_.isUndefined(e.generationConfig.segments)&&!this.getPivotField()||t.length>0)&&this.fields.add(this.createAnalyticsAllSegmentFromSegments(t,e.sourceId||e.generationConfig.sourceId),{parse:!0}),_.each(e.generationConfig.groups,(function(e){e.origin="groups",e.edit=!1,this.fields.add(e,{parse:!0})}),this)),this.cleanFilters(),e.data.XAxis||(e.data.XAxis=e.data.hAxis||{},e.data.XAxis.displayAxisLabel=e.data.displayXAxis,delete e.data.hAxis),e.data.XAxis.labels||(e.data.XAxis.labels=e.data.labels||{},e.data.XAxis.labels.enabled=!0,delete e.data.displayXAxis),e.data.YAxis||(e.data.YAxis=e.data.vAxis||{},e.data.YAxis.displayAxisLabel=e.data.displayYAxis),e.data.YAxis2||(e.data.YAxis2=e.data.vAxis||{},e.data.YAxis2.displayAxisLabel=e.data.displayYAxis,e.data.YAxis2.displayAxisLabel=e.data.displayYAxis),e.data.YAxis.labels||(e.data.YAxis.labels=e.data.labels||{},e.data.YAxis.labels.enabled=!0),e.data.YAxis2.labels||(e.data.YAxis2.labels=e.data.labels||{},e.data.YAxis2.labels.enabled=!0),_.isString(e.data.XAxis.title)&&(e.data.XAxis.axisLabel=e.data.XAxis.title,e.data.XAxis.title={style:this.defaults.data.XAxis.title.style}),_.isString(e.data.YAxis.title)&&(e.data.YAxis.axisLabel=e.data.YAxis.title,e.data.YAxis.title={style:this.defaults.data.YAxis.title.style}),e.data.legend&&_.isString(e.data.legend.displayLegendTable)&&(e.data.legend.subtable={enabled:!0},delete e.data.legend.displayLegendTable),_.isString(e.data.YAxis2.title)&&(e.data.YAxis2.axisLabel=e.data.YAxis2.title,e.data.YAxis2.title={style:this.defaults.data.YAxis2.title.style}),_.isObject(e.data.legend)&&"none"===e.data.legend.position&&(e.data.legend.enabled=!1,e.data.legend.position="auto"),e.data.series)for(var s in e.data.series){var r=$.extend(!0,{},e.data.series[s]);delete e.data.series[s],e.data.series[s.replace(/[\.\s\[\]]/g,"_")]=r}return _.isUndefined(e.data.YAxis.reversedStacks)&&(e.data.YAxis.reversedStacks=!0,e.data.YAxis2.reversedStacks=!0),e.generationConfig.type&&e.generationConfig.type.indexOf("number")>-1&&(!e.data.numberFormat&&e.data.showThousandSeperator&&(e.data.numberFormat="format8"),e.data.style.fontRelativeSize||(e.data.style.fontRelativeSize="auto"),e.data.style.fontIsBold||(e.data.style.fontIsBold=!1),e.data.style.fontIsItalic||(e.data.style.fontIsItalic=!1),e.data.style.fontIsUnderline||(e.data.style.fontIsUnderline=!1),e.data.style.fontFamily||(e.data.style.fontFamily="Arial"),e.data.style.strokeColor||(e.data.style.strokeColor="transparent"),e.data.style.fontColor||(e.data.style.fontColor="#666")),new RegExp("number|gauge","i").test(e.generationConfig.type)&&e.commonConfig&&(e.commonConfig.useAsFilter=!1),e.data.title||(e.data.title=l),e.generationConfig.activeTimeFields||(e.generationConfig.activeTimeFields=[]),e.isStatic=!!e.isStatic,_.deep(e,"generationConfig.SQLBox")&&!_.deep(e,"generationConfig.SQLBox.downsampling.threshold")&&_.deep(e,"generationConfig.downsampling.threshold")&&(e.generationConfig.SQLBox.downsampling=_.extend({},e.generationConfig.SQLBox.downsampling,{threshold:e.generationConfig.downsampling.threshold})),a.channel.analyzer.trigger("request:lockIncompatibleFields",this.fields),this.hasTimeFields(e)||(e.data.isZoomActiveForChartData=!1,e.data.isZoomActive=!1),(n=_.deep(e,"data.backgroundColor")||_.deep(e,"data.style.backgroundColor"))&&(_.contains(["number-default","dynamic_text"],e.generationConfig.type)||(_.deep(e,"data.style.backgroundColor",n),_.deep(e,"data.backgroundColor",n)),delete e.data.backgroundColor),_.deep(e,"data.style.backgroundColor")||_.deep(e,"data.style.backgroundColor","#FFFFFF"),"pie"!==e.generationConfig.type||_.isUndefined(e.data.showPieDatalabels)||(e.data.showDatalabels=e.data.showPieDatalabels,delete e.data.showPieDatalabels),e.data.gaugeOptions&&e.data.gaugeOptions.showArrow&&!_.isBoolean(e.data.gaugeOptions.showArrow)&&("yes"===e.data.gaugeOptions.showArrow?e.data.gaugeOptions.showArrow=!0:"no"===e.data.gaugeOptions.showArrow&&(e.data.gaugeOptions.showArrow=!1)),"number-default"===e.generationConfig.type&&!e.data.numberChartBackgroundColor&&e.data.backgroundColor&&(e.data.numberChartBackgroundColor=e.data.backgroundColor,delete e.data.backgroundColor),$.extend(!0,{},this.defaults,e)},save:function(e,t,i){var n=this;if(!this.tab){if(i=i||{},this.normalizeGraphMap(),this.gizmoModel)this.gizmoModel.set("content.data",_.deepClone(this.get("data")),{silent:!0}),this.get("needRegenerate")||this.gizmoModel&&a.channel.app.trigger("dashboardState:redrawGizmos",this.gizmoModel,!1),this.gizmoModel&&this.gizmoModel.get("isContainer")&&(i.additionalUrlValues=i.additionalUrlValues||{},i.additionalUrlValues.isContainer=!0);a.channel.app.trigger("dashboard:checkStyleClone",this);var s=Backbone.Model.prototype.save.apply(this,[e,t||i,i]);return this.get("needRegenerate")&&(s.done((function(){n.gizmoModel&&a.channel.app.trigger("dashboardState:redrawGizmos",n.gizmoModel,!0)})),this.unset("needRegenerate")),s}},normalizeGraphMap:function(e){var t=!1;return e=e||this.graphMapData,_.each(e,(function(e){_.each(e.edges,(function(e){e.metadata.removeDuplication&&(t=!0)}))})),t?(this.set("graphMapData",e,{silent:!0}),e):(this.set("graphMapData",{},{silent:!0}),null)},removeCurrentGraphMap:function(){delete this.graphMapData,this.set("graphMapData",{},{silent:!0})},_setSeriesColors:function(){var e=_.map(i.get("organizationConfig.colors"),(function(e){return{seriesColor:e}}));this.set("data.seriesColors",e,{silent:!0})},getPivotField:function(){return this.fields.find((function(e){return"filters"===e.get("origin")&&e.get("pivot")&&!e.isAllSegments()}))},clearManualOrder:function(){this.set({"data.seriesOrder":[],"data.seriesOrderApplied":!1,"data.categoriesOrder":[],"data.categoriesOrderApplied":!1})},sortChartByDecompose:function(e){this.set("data.seriesOrderDecompose",e)},cleanFilters:function(){var e,t=[];e=this,this.fields.each((function(i){"groups"===i.get("origin")&&0===e.fields.filter((function(e){return"groups"!==e.get("origin")&&d(i,e)})).length&&t.push(i),"filters"===i.get("origin")&&i.get("linked")&&0===e.fields.filter((function(e){return e.get("origin")===i.get("linked")&&d(i,e)})).length&&t.push(i)})),e.fields.remove(t)},toJSON:function(){var e=this;this.cleanFilters();var t,i,a=_.clone(this.attributes);if(a.data={},a.generationConfig={},delete a.creationDate,a.generationConfig.type=this.attributes.generationConfig&&this.attributes.generationConfig.type||this.attributes.type,_.each(r,(function(e){this.has(e)&&_.deep(a,e,_.deepClone(_.deep(this.attributes,e)))}),this),_.deep(a,"data.legend.isActuallyEnabled")&&delete a.data.legend.isActuallyEnabled,this.isChartFacebook()&&a.data.series?a.data.series=this.attributes.data.series:a.data.series&&(a.data.series=this.cleanSeriesSettings(this.attributes.data.series)),delete a.type,a.generationConfig.dimensions=[],this.fields.each((function(e){_.isEmpty(e.get("tableLabel"))&&!_.isEmpty(e.get("tableName"))&&e.set("tableLabel",n.convertTableName(e.get("tableName"))),_.isEmpty(e.get("label"))&&!_.isEmpty(e.get("columnName"))&&e.set("label",e.get("columnName"))})),_.each(this.fields.filter((function(e){return"dimensions"==e.get("origin")})),(function(i){var n;i.get("isMetricEdit")||(n=e.getXYFilter(i),i.get("withPreviousPeriod")&&!1!==n&&n.set("withPreviousPeriod",!0),delete(t=i.toJSON()).index,delete t.edit,delete t.groupData,t.columnId||(t.columnId=t.id),a.generationConfig.dimensions.push(t))})),_.isEmpty(a.generationConfig.dimensions)&&delete a.generationConfig.dimensions,a.generationConfig.measures=[],_.each(this.fields.filter((function(e){return!e.get("isColumnInjected")&&"measures"==e.get("origin")&&!e.get("formula")})),(function(e){e.get("isMetricEdit")||(delete(i=e.toJSON()).index,delete i.edit,delete i.groupData,i.columnId||(i.columnId=i.id),!0===a.generationConfig.geocoding&&"AVG"===i.aggregation&&(i.aggregation="AVG_COUNT"),a.generationConfig.measures.push(i))})),a.generationConfig.measures.length&&this.isChartBubble()){var s=0,l=a.generationConfig.measures.reduce((function(e,t){return e[t.zAxis?1:0].push(t),e}),[[],[]]);for(a.generationConfig.measures=[];l[0].length&&l[1].length&&s++<1e4;)a.generationConfig.measures.push(l[0].shift()),a.generationConfig.measures.push(l[1].shift());a.generationConfig.measures=a.generationConfig.measures.concat(l[0],l[1])}_.isEmpty(a.generationConfig.measures)&&delete a.generationConfig.measures,a.generationConfig.filters=[],this.fields.find((function(e){return e.isAllSegments&&e.get("pivot")}))&&(a.generationConfig.segments=[]);var d=[];_.each(this.fields.filter((function(e){return"filters"==e.get("origin")})),(function(t){if(!t.get("isMetricEdit")){delete(d=t.toJSON()).index,delete d.edit,delete d.groupData;var i=_.find(a.generationConfig.filters,(function(e){return _.isEqual(e,d)}));if(d.columnId||(d.columnId=d.id),a.generationConfig.type&&a.generationConfig.type.indexOf("number")>-1&&(d.pivot||_.contains(["groups"],d.linked)))return!1;i||(t.isAnalyticsSegment()?d.pivot?a.generationConfig.segments.push(d):(d=e.convertAnalyticsSegmentToFilter(d),a.generationConfig.filters.push(d)):t.isAllSegments()&&d.pivot?a.generationConfig.segments=t.get("segments")||[]:a.generationConfig.filters.push(d))}})),a.generationConfig.metrics=[];var g=[];return _.each(this.fields.filter((function(e){return e.get("isColumnInjected")||"metric"===e.get("linked")||!!e.get("formula")||"metric"===e.get("origin")})),(function(e){e.get("isMetricEdit")||(delete(g=e.get("data")||e.toJSON()).index,delete g.edit,delete g.groupData,g.columnId||(g.columnId=g.id),g.id||(g.id=n.generateGUID()))})),_.isEmpty(a.generationConfig.filters)&&delete a.generationConfig.filters,a.generationConfig.groups=[],_.each(this.fields.filter((function(e){return"groups"==e.get("origin")})),(function(e){if(!e.get("isMetricEdit")){var t=e.toJSON();delete t.index,delete t.edit,delete t.groupData,t.columnId||(t.columnId=t.id),_.find(a.generationConfig.groups,(function(e){return _.isEqual(e,t)}))||a.generationConfig.groups.push(e.toJSON())}})),_.isEmpty(a.generationConfig.groups)&&delete a.generationConfig.groups,!a.generationConfig.type||-1===a.generationConfig.type.indexOf("number")&&-1===a.generationConfig.type.indexOf("solidgauge")?a.generationConfig=this.clearValue(a.generationConfig,"withPreviousPeriod"):(a.generationConfig.groups=[],_.each(this.fields.filter((function(e){return"groups"==e.get("origin")})),(function(e){var t=this.getXYFilter(e);if(!1!==t)for(var i=0,n=a.generationConfig.filters.length;i<n;i++)JSON.stringify(a.generationConfig.filters[i])===JSON.stringify(t.toJSON())&&delete a.generationConfig.filters[i]})),delete a.generationConfig.segments),a.sourceId=a.sourceId||a.data.sourceId||a.generationConfig.sourceId,"SQLQUERY"===a.source&&(a.generationConfig.measures=[],a.generationConfig.dimensions=[],a.generationConfig.filters=[],a.generationConfig.groups=[]),delete a.generationConfig.metrics,_.isEmpty(_.deep(a,"data.isZoomActiveForChartData"))||delete a.data.isZoomActiveForChartData,!this.isChartGauge()&&a.data.gaugeOptions&&delete a.data.gaugeOptions,this.isNew()&&a.data.style&&!this.get("data.style.version")&&(this.set("data.style.version",1,{silent:!0}),a.data.style.version=1),a.style=_.deepClone(a.data),_.each(o,(function(e,t){this.has(e)&&_.deep(a,t,_.deep(a,e))}),this),a.name||(a.name=this.getTranslationTitle()),a},cleanSeriesSettings:function(e){var t=/.*(ds_[0-9A-Za-z]+).*/,i=this.fields.chain().map((function(e){var i=t.exec(e.get("tableName"));return _.isNull(i)?null:i[1]})).unique().without(null).value(),n={};return _.each(e,(function(e,a){var s=t.exec(a),o=this.isChartDatasource();_.contains(i,_.isArray(s)?s[1]:s)&&o?n[a]=e:o?_.isNull(s)&&(n[a]=e):n[a]=e}),this),n},clearValue:function(e,t){var i,n;if(e.dimensions)for(i=0,n=e.dimensions.length;i<n;i++)_.isUndefined(e.dimensions[i][t])||delete e.dimensions[i][t];if(e.filters)for(i=0,n=e.filters.length;i<n;i++)_.isUndefined(e.filters[i][t])||delete e.filters[i][t];return e},convertAnalyticsSegmentToFilter:function(e){return{id:"ga:allSegments",columnId:"ga:allSegments",columnType:"SEGMENT",fields:[{negation:!1,values:[e]}]}},convertSegmentFilterToAnalyticsFilter:function(e){return e.fields[0].values[0]},createAnalyticsAllSegmentFromSegments:function(t,i){return i=i||_.deep(t,"[0].sourceId"),{id:"ga:allSegments",type:"SEGMENT",dataType:"SEGMENT",group:"Segments",status:"PUBLIC",description:"",columnName:e.js_041d2263189890fa02ca3fa1d3fc2602,label:e.js_041d2263189890fa02ca3fa1d3fc2602,active:!0,tableLabel:"Segments",tableName:"Segments",columnType:"SEGMENT",sourceId:i,selected:!1,disable:!1,show:!0,displayTitle:e.js_041d2263189890fa02ca3fa1d3fc2602,origin:"filters",pivot:!0,edit:!1,segments:t}},isChartReadyToGenerate:function(e){var t=[],i=[],n=[];return this.isChartSQLQuery()?this.has("generationConfig.SQLBox.query")&&this.has("generationConfig.SQLBox.dataSourceInfoIds"):this.isChartMDXQuery()?this.has("generationConfig.MDXBox.query")&&this.has("generationConfig.MDXBox.dataSourceInfoId"):(this.fields.each((function(e){e.isMeasure()&&!e.isTooltip()&&!e.isSize()&&i.push(e),e.isDimension()&&t.push(e),e.isDecompose()&&n.push(e)})),this.isChartTable()&&e?t.length||i.length:this.isChartNumber()||this.isChartGauge()?i.length>0&&!t.length&&!n.length:this.isChartText()?1===t.length&&"STRING"===t[0].get("basicType")&&0===i.length:t.length&&i.length)},detectSourceType:function(){var e=[];this.fields.each((function(t){if(t.has("id"))if(t.isMetric()){var i=t.get("expressionConfig");i&&i.columns&&_.each(i.columns,(function(t){e.push(t.id)}))}else e.push(t.get("id"))}));var t=e.join("|");if(t){var i=t.indexOf("ga:")>-1,n=t.indexOf("fa:")>-1;this.set("source","DEFAULT",{silent:!0}),n&&!i?this.set("source","FACEBOOK",{silent:!0}):!n&&i&&this.set("source","ANALYTICS",{silent:!0})}return this.get("source")},isChartCertainType:function(e){var t=this.detectSourceType();return!!_.isString(t)&&t.toLowerCase()===e},isChartAnalytics:function(){return this.isChartCertainType("analytics")},isChartFacebook:function(){return this.isChartCertainType("facebook")},isChartSQLQuery:function(){return this.isChartCertainType("sqlquery")},isChartGauge:function(){return"solidgauge"===this.getChartType()},isChartNumber:function(){return"number-default"===this.getChartType()},isIcon:function(){return"icon"===this.getGizmoType()},isLine:function(){return"line"===this.getGizmoType()},isImage:function(){return"image"===this.getGizmoType()},isChart:function(){return"chart"===this.getGizmoType()},isChartSpiderweb:function(){return"spiderweb"===this.getChartType().toLowerCase()},isChartMDXQuery:function(){return this.isChartCertainType("mdxquery")},isChartTable:function(){return"table"===this.getChartType()},isChartGizmoText:function(){return"text"===this.getGizmoType()},isChartText:function(e){var t="dynamic_text"===this.getChartType();return e?t&&!this.isChartWithLink():t},isChartWithLink:function(){return this.get("data.textAsLink")},isChartMap:function(){return"map"===this.getChartType()},isChartBubble:function(){return"bubble"===this.getChartType()},isChartPackedBubble:function(){return"packedbubble"===this.getChartType()},isChartScatter:function(){return"scatter"===this.getChartType()},isChartLine:function(){return"line"===this.getChartType()},isChartArea:function(){return"area"===this.getChartType()},isChartStream:function(){return"streamgraph"===this.getChartType()},isChartStacked:function(){return/stacked/gi.test(this.getChartType())},hasBelowTitle:function(e){return e?!this.get("data.title.isHidden")&&!1===this.get("data.title.position")&&!1===this.get("data.title.subtitleIsHidden"):!((this.get("data.title.isHidden")||!1!==this.get("data.title.position"))&&(this.get("data.title.subtitleIsHidden")||!1!==this.get("data.title.subtitlePosition")))},isChartDatasource:function(){return!(this.isChartAnalytics()||this.isChartSQLQuery()||this.isChartMDXQuery())},onRemoveField:function(e){var t;t=!1,this.unset("data.series._"+e.getDisplayName()),_.each(this.get("data.series"),(function(e){e.showOnSecondaryAxis&&(t=!0)})),!1===t&&this.set("data.YAxis2",this.defaults.data.YAxis2);var i=this.getXYFilter(e);i&&this.fields.remove(i);var n=this.getXYGroups(e);n&&this.fields.remove(n)},getXYFilter:function(e){return!_.isUndefined(e)&&(this.fields.find((function(t){return"filters"===t.get("origin")&&t.has("linked")&&d(t,e)}))||!1)},getGeneralXYFilter:function(e){if(_.isUndefined(e))return!1;var t=this.fields.find((function(t){return"filters"===t.get("origin")&&d(t,e)}));return t||!1},getGeneralFilterValues:function(e){return this._getGeneralFilter(e).foundFilterValues},_getGeneralFilter:function(e){var t,i=this.getGeneralXYFilter(e);return i&&i.get&&i.get("fields")?(t=i.get("fields"),e.isText()&&t.length&&t[0].values&&(t=t[0].values)):i&&i.get&&i.get("dynamic")?(t={dynamic:i.get("dynamic")},i.get("customTime")&&(t.customTime=i.get("customTime"))):i.fields?(t=i.fields,e.isText()&&t.length&&t[0].values&&(t=t[0].values)):i[0]&&i[0].fields&&(t=i[0].fields,i=i[0],e.isText()&&t.length&&t[0].values&&(t=t[0].values)),{foundFilter:i,foundFilterValues:t}},isFilterPropertyFound:function(e,t,i){return i||(i=this._getGeneralFilter(t).foundFilter),!!i&&(i.has?i.has(e):!!i.propertyName)},isAllSelected:function(e,t){var i=!1,n=this.getGeneralXYFilter(e);return n?e.isText()&&(i=(n.isXYFilter&&n.isXYFilter(),n.get&&!n.get("fields")||(n.get&&n.get("fields")&&n.get("fields")[0]&&n.get("fields")[0].values||[]).length===t)):i=!0,i},isAllSelectedOnFly:function(e,t,i,n){var a,s,o;(a=!1,s=this.getGeneralXYFilter(e),i.length)||(s?(e.isText()||e.isAllSegments())&&(s&&!s.get?!s.fields||(s.fields[0].values||[]).length===n?a=!0:(o=s.fields&&s.fields.length&&s.fields[0].values?s.fields[0].values:[],a=_.union(o,t).length===n):!s.get("fields")||(s.get("fields")[0].values||[]).length===n?a=!0:(o=s.get("fields")&&s.get("fields").length&&s.get("fields")[0].values?s.get("fields")[0].values:[],a=_.union(o,t).length===n)):a=!0);return a},setXYFilter:function(e,t,i,n){var a,s,o,r,l="AND",d={};if(s=[],o=[],r=e.get("negateNegation"),e.isText())a=[{negation:e.get("negation")||!1,values:t&&t[0]&&t[0].values||t}],r&&(a[0].negation=!a[0].negation);else if(e.isNumber()||e.isBoolean())_.isArray(t)?(a=t,_.size(t)>1&&!e.isFacebook()&&(l="OR"),_.each(a,(function(i){i&&(i.negation=i.negation||(t.negation?t.negation:e.get("negation")||!1))}))):((a=[])[0]=t,a[0].negation=t.negation?t.negation:e.get("negation")||!1),s=_.filter(t,(function(e){return e.isAggregation})),o=_.filter(t,(function(e){return!e.isAggregation})),a.length>0?(s.negation=a[0].negation,o.negation=a[0].negation):(s.negation=!1,o.negation=!1);else if(e.isTime()){if(a=t,!t||t[0]&&_.isUndefined(t[0].min)&&_.isUndefined(t.dynamic))return;_.size(t)>1&&(l="OR")}var g=this.getGeneralXYFilter(e);if(s.length>0&&(d={origin:"filters",columnType:e.getColumnType(),columnName:e.get("columnName"),columnId:e.get("id"),tableName:e.get("tableName"),aggregationFilter:{columnType:e.getColumnType(),columnName:e.get("columnName"),columnId:e.get("id"),tableName:e.get("tableName"),aggregationType:e.get("aggregation"),type:l,fields:s,negateNegation:r}}),o.length>0?(_.isEmpty(d)?d={origin:"filters",type:l,columnType:e.getColumnType(),columnName:e.get("columnName"),columnId:e.get("id"),tableName:e.get("tableName"),fields:o,negateNegation:r}:(d.type=l,d.fields=o),e.isAnalytics()&&(d.sourceId=e.get("sourceId"),delete d.type),_.isEmpty(a)&&(d.excludeAll=!0)):(a.length>0||_.isObject(a))&&!s.length&&(d={origin:"filters",type:l,columnType:e.getColumnType(),columnName:e.get("columnName"),columnId:e.get("id"),tableName:e.get("tableName"),fields:a,negateNegation:r}),e.get("withPreviousPeriod")&&this.get("generationConfig.type").indexOf("number")>=0?d.withPreviousPeriod=!0:e.unset("withPreviousPeriod"),"metric"===e.get("origin")||"metric"===e.get("linked")?(d.linked="metric",t?d.fields=a:!0===e.get("negation")&&(d.excludeAll=!0)):t?(s.length>0&&(d.aggregationFilter.fields=s),o.length>0&&(d.fields=o)):!0===e.get("negation")&&(d.excludeAll=!0),!1!==i&&!0!==i||(d.checked=i),"metric"===e.get("origin")||"metric"===e.get("linked")?d.linked="metric":e.isFilter()||(d.linked=e.get("origin")),(e.isFilter()||e.isDecompose())&&delete d.linked,e.isTime()&&e.get("dynamic")&&(d.dynamic=e.get("dynamic"),e.get("customTime")&&(d.customTime=e.get("customTime")),delete d.fields),e.isTime()&&(e.get("timeFormat")&&(d.timeFormat=d.withPreviousPeriod?"month":e.get("timeFormat")),d.excludeFutureDates=e.get("excludeFutureDates")),e.isMetric()&&(d.expressionConfig=e.get("expressionConfig")),g){var u=this.fields.indexOf(g),f=this.fields.at(u);void 0!==f&&(f.unset("aggregationFilter",{silent:!0}),f.unset("dynamic",{silent:!0}),f.unset("customTime",{silent:!0}),f.unset("excludeFutureDates",{silent:!0}),!f.has("checked")||!1===i&&!0===i||f.unset("checked",{silent:!0}),f.unset("fields",{silent:!0}),f.set(d,{silent:!0}))}else this.fields.add(d,{silent:!0})},selectAllFieldValues:function(e){var t=this.getGeneralXYFilter(e);t.isXYFilter()?this.removeXYFilter(e):(t.isDecompose()||t.isStandaloneFilter())&&t.unset("fields",{silent:!0})},removeGeneralFilter:function(e){var t=this.getGeneralXYFilter(e);t&&this.fields.remove(t)},removeXYFilter:function(e){var t=this.getXYFilter(e);t&&("metric"===e.get("origin")&&e.unset("filter"),this.fields.remove(t))},getXYGroups:function(e){var t=this.fields.find((function(t){return"groups"===t.get("origin")&&d(t,e)}));return t||!1},setXYGroups:function(e,t){var i=this.getXYGroups(e);if(i){var n=this.fields.indexOf(i);this.fields.at(n).set({fields:t},{silent:!0})}else{var a={columnId:e.id,fieldId:e.id,origin:"groups",columnType:e.getColumnType(),columnName:e.get("columnName"),tableName:e.get("tableName"),fields:t};e.isMetric()&&(a.columnType=e.get("expressionConfig.returnType")),this.fields.add(a,{silent:!0})}},removeXYGroups:function(e){var t=this.getXYGroups(e);t&&this.fields.remove(t,{silent:!0})},getTranslationTitle:function(){return(e.chartTitleDefault||"").trim()||"Untitled"},clearAll:function(t){this.fields.reset([]),this.set("name",e.chartTitleDefault),this.trigger("change"),this.trigger("remove");var i=this.get("data.style.version"),n=this.get("data.style.title");this.set("data",_.extend({},this.defaults.data,{seriesColors:this.get("data.seriesColors")}),{silent:!0}),n&&n.fontSizeNormalized&&this.set("data.style.title.fontSizeNormalized",!0),this.set("data.style.version",i),this.set("generationConfig",_.extend({},this.defaults.generationConfig),{silent:!0}),this.set("commonConfig",{}),this.get("commonConfig.tooltip")&&this.set("commonConfig.tooltip",null,{silent:!0}),a.channel.app.trigger("uneditField"),a.channel.app.trigger("clearChart"),a.channel.app.trigger("chart:closesettings"),this.set("isDirty",!1,{silent:!0}),this.trigger("clearChart"),a.channel.app.trigger("generateChart",this)},isChartFitForAlert:function(){var e,t={result:!1,measures:0,dimensions:0,isTimeDimension:!1,decompose:!1,isInvalidDatasource:!1,isSqlQuery:!1,accumulationOverTime:!1};if(this.fields.models[0]&&this.fields.models[0].get("dataSourceType")&&null!==this.fields.models[0].get("dataSourceType").match(/^(fb_|facebook)/gi))t.isInvalidDatasource=!0;else if("SQLQUERY"===this.get("source")){t.isSqlQuery=!0,e=this.get("generationConfig.SQLBox"),t.measures=e.yAxis&&1===e.yAxis.length?1:0,t.dimensions=e.xAxis&&e.xAxis.length>0?1:0,t.decompose=e.dAxis&&e.dAxis.length>0?1:0;var i=this.getSqlBoxAxisColumns("xAxis");t.isTimeDimension=_.filter(i,(function(e){return"TIME"===e.basicType})),t.isTimeDimension=0!==t.isTimeDimension.length&&t.isTimeDimension}else _.each(this.fields.models,(function(e){switch(e.get("origin")){case"measures":t.measures++,t.accumulationOverTime=e.get("accumulation");break;case"dimensions":t.dimensions++,t.isTimeDimension=e.isTime();break;case"filters":t.decompose=t.decompose||!!e.isDecompose()}}));return t.result=!t.isInvalidDatasource&&!t.accumulationOverTime&&1===t.measures&&1===t.dimensions&&t.isTimeDimension&&!t.decompose,t},isDecomposed:function(){return this.isChartSQLQuery()?(this.get("generationConfig.SQLBox.dAxis")||[]).length>0:!!this.fields.find((function(e){return e.isDecompose()}))},isPivot:function(){return!_.isUndefined(this.getPivotField())},isDataValidForTextChart:function(){var e,t,i;return!!this.isChartSQLQuery()&&(e=this.get("generationConfig.SQLBox.xAxis")||[],t=this.get("generationConfig.SQLBox.yAxis")||[],i=this.get("generationConfig.SQLBox.dAxis")||[],!!e&&(1===e.length&&t&&0===t.length&&i&&0===i.length))},getDecomposeField:function(e){var t=this.fields.find((function(t){return"filters"===t.get("origin")&&!0===t.get("pivot")&&d(t,e)}));return t||!1},isFilterOnlyField:function(e){var t=this.fields.find((function(t){return"filters"===t.get("origin")&&!t.get("linked")&&d(t,e)}));return t||!1},getChartType:function(e){return e&&this.get("generationConfig.autoType")?"auto":this.get("generationConfig.type")||t.defaultChartType},getGizmoType:function(){return this.get("type")||this.get("generationConfig.type")},resetChartType:function(){if(this.isChartSQLQuery()){var e=this.get("generationConfig.SQLBox.yAxis");this.get("generationConfig.SQLBox.xAxis");"pie"===this.getChartType()&&(_.isArray(e)&&e.length>1?this.set("generationConfig.type","line"):_.isArray(e)&&0===e.length&&this.set("generationConfig.type","table"))}},getMeasureFields:function(e){return this.fields.filter((function(t){return t.isMeasure()&&(!e||!t.isTooltip())}))},getMeasureTooltips:function(){return this.fields.filter((function(e){return e.isMeasure()&&e.isTooltip()}))},getDimensionsFields:function(){return this.fields.filter((function(e){return e.isDimension()}))},getDecomposeFields:function(){return this.fields.filter((function(e){return e.isDecompose()}))},getSizesFields:function(){return this.fields.filter((function(e){return e.isSize()}))},getFirstZAxis:function(){return this.fields.find((function(e){return e.get("zAxis")}))},getForecastEnabled:function(){var e=this.fields.find((function(e){return e.get("forecastConfig.enabled")}));return e&&e.get("forecastConfig.type")},disableChartForecast:function(){this.has("commonConfig.forecastConfig")&&this.set("commonConfig.forecastConfig.enabled",!1),this.fields.each((function(e){e.isMeasure()&&e.has("forecastConfig")&&e.set("forecastConfig.enabled",!1)}))},getSerie:function(e){return this.getSeries()[e]},isChartPie:function(){return-1!==this.getChartType().indexOf("pie")},getSeries:function(){return this.get("data")&&this.get("data").series?this.get("data").series:_.clone(t.chartOptions.series)||{}},GroupFieldsUtils:{fields:{getAllGroupNames:function(e){return _.map(e,(function(e){return e.label}))},getAllGroupsValues:function(e){return this.getGroupsValues(this.getAllGroupNames(e),e)},isContainedInGroups:function(e,t){var i=this.getAllGroupNames(t);return _.contains(i,e)},getGroupByName:function(e,t){return _.find(t,(function(t){return e===t.label}))},getGroupValues:function(e,t){var i=this.getGroupByName(e,t);return i?i.values:[]},getGroupsValues:function(e,t){var i=[];return _.each(e,(function(e){i.push.apply(i,this.getGroupValues(e,t))}),this),i},getGroupValueBelongsTo:function(e,t){return _.find(t||[],(function(t){return _.contains(t.values||[],e)}))||null},getNonGroupValuesOnly:function(e,t){var i=t?t.get("fields"):[],n=[],a=e||[];return i.length&&(n=this.getAllGroupsValues(i),a=_.difference(e,n)),a}}},FilterFieldsUtils:{fields:{isValueFound:function(e,t){return!!this.getFilterFieldDataContainingValue(e,t)},getValuesNotFound:function(e,t){var i=_.clone(e)||[];return _.each(e,(function(e){this.isValueFound(e,t)&&(i=_.without(i,e))}),this),i},getFilterFieldDataContainingValue:function(e,t){return _.find(t,(function(t){return _.contains(t.values||[],e)}))},getValuesWithout:function(e,t){var i=this.getFilterFieldDataContainingValue(e,t);return i?_.without(i.values||[],e):[]},getEmptyFilterFieldsDataItem:function(e,t){return new this.FilterFieldsItem({negation:t||!1,values:e||[]})},FilterFieldsItem:Backbone.Model.extend({defaults:{negation:!1,values:[]}})}},isValueFoundInFilter:function(e,t,i){var n=i||this.getGeneralXYFilter(t),a=[],s=!1;return i[0]&&(i=i.shift()),!n||n&&n.get&&!n.get("fields")||!n||!n.fields&&_.isArray(n)?s=!0:(n&&n.get&&n.get("fields")&&n.get("fields").length||n&&n.fields&&n.fields.length)&&t.isText()&&(a=n.get&&_.deep(n.get("fields"),"[0].values")||_.deep(n,"fields[0].values")||[],s=_.contains(a,e)),s},addValuesToFilter:function(e,t){var i=this.getGeneralXYFilter(t),n=[],a=[];return t.isText()&&(n=i&&i.get("fields")&&i.get("fields").length&&i.get("fields")[0].values||[],a=_.union(n,e)),a},setSQLQuery:function(e){return!!_.isString(e)&&(this.set("generationConfig.SQLBox.query",e),!0)},setDatasourceIds:function(e,t){return!!_.isArray(e)&&(this.set("generationConfig.SQLBox.dataSourceInfoIds",e),t&&t.set("generationConfig.SQLBox.dataSourceInfoIds",e),!0)},createDatasourceAliases:function(e,t,i){var n,a,s,o={};if(!_.isString(e))return!1;if(!_.isArray(t)&&t.length<=1)return!1;for(var r=0,l=(n=_.unique(e.match(/{[^}]*}/g))).length;r<l;r++)a=n[r].replace(/[{}]/g,""),(s=_.find(t,(function(e){return e.name===a})))&&(o[a]=s.value);return this.setDatasourceAliases(o,i)},setDatasourceAliases:function(e,t){return!!_.isObject(e)&&(this.set("generationConfig.SQLBox.dataSourceInfosAlias",e),t&&t.set("generationConfig.SQLBox.dataSourceInfosAlias",e),!0)},checkIfHasDuplication:function(){this.fields.allowEditDuplication&&this.fields.allowEditDuplication()},chartAlarmsLinked:function(e,t){var i=$.Deferred(),a=this;return this.AlarmsLinkedProgress?i:("get"!==t&&(this.AlarmsLinked=void 0),this.AlarmsLinked?(i.resolve(this.AlarmsLinked),i):(this.AlarmsLinkedProgress=!0,n.ajaxOrg(this.url()+"/chartAlarm",{data:e,requestType:"get"===t?"GET":"POST",success:function(e){e.result?(a.AlarmsLinked=e.result.data,a.set("chartAlarm",a.AlarmsLinked),i.resolve(a.AlarmsLinked)):i.reject(),a.AlarmsLinkedProgress=!1,"get"!==t&&a.trigger("update:chartalarm")},error:function(e,t){i.reject({description:e,error_code:t}),a.AlarmsLinkedProgress=!1}}),i))},isTargetPreviousPreiod:function(){return this.get("data.showTrendIndicator")||this.get("data.previousPeriodPercentage")||this.get("data.previousPeriodAbsolute")||"lastPeriod"===this.get("data.gaugeOptions.maxValueIndicator")},setFontFamilyForChart:function(){var e=this.get("data.chartFont.fontFamily");this.set({"data.YAxis.title.style.fontFamily":e,"data.YAxis2.title.style.fontFamily":e,"data.XAxis.title.style.fontFamily":e,"data.YAxis.labels.style.fontFamily":e,"data.YAxis2.labels.style.fontFamily":e,"data.XAxis.labels.style.fontFamily":e,"data.dataLabelStyle.style.fontFamily":e,"data.legend.itemStyle.fontFamily":e,"data.fontFamily":e,"data.title.fontFamily":e}),_.each(this.get("data.series"),(function(t,i){this.set("data.series."+i+".dataLabels.style.fontFamily",e)}),this)},resetSettings:function(e,t){/gauge/gi.test(t)&&(this.set("data.showDatalabels",!0),this.set("data.showDatalabelsPercentage",!1),_.each(this.get("data.series"),(function(e){e.showDataLabels=!0,e.showDatalabelsPercentage=!1})))},cleanDatasourceIds:function(e){var t=this.get("generationConfig.SQLBox.dataSourceInfoIds");if(t&&t.length&&e.length){var i=_.difference(t,e);if(i.length){var n=_.difference(t,i);this.set("generationConfig.SQLBox.dataSourceInfoIds",n)}}},isInteractive:function(){return i.isSSOPropertyAllowed("dashboardInteractivity")},canUseAsFilter:function(){return this.isInteractive()&&!!this.get(this.useAsFilterConst)},canUseAsDrilldown:function(){return this.isInteractive()&&this.isDrilldownEnabled()||this.isChartDrilldown()},isDrilldownEnabled:function(){var e=this.get("chartDrilldown.drillDownList");return!(!e||!e.length)},isChartDrilldown:function(){return!!this.get("isDrilldown")},isChartMapBubble:function(){return"mapbubble"===this.get("data.mapStyle.type")},getSqlBoxObject:function(e){return _.deep(e,"generationConfig.SQLBox")||this.get("generationConfig.SQLBox")||{}},isZoomActive:function(){return this.isInteractive()&&this.get("data.isZoomActive")},isZoomActiveForChart:function(){return this.get("data.isZoomActiveForChartData")},canUseZoomToFilter:function(){return!(!this.isZoomActive()||!this.isZoomActiveForChart())},setZoomActiveForChart:function(e){this.set("data.isZoomActiveForChartData",e,{silent:!0})},hasTimeFields:function(e){if(this.isChartSQLQuery()||e&&"SQLQUERY"===e.source){var t=this.getSqlBoxObject(e),i=["TIME","DATE"];return t&&_.any(t.columnsInQuery,(function(e){return new RegExp(i.join("|"),"i").test(e.basicType)||new RegExp(i.join("|"),"i").test(e.columnType)}))}return this.fields.hasTimeFields()},filterDateFormat:function(e){var t="get";return _.isUndefined(e)||(t="set"),this[t]("data.filterDateFormat",e)},hasSqlBoxZoom:function(){var e=this.getSqlBoxObject();return new RegExp("dp_zoom","i").test(e.query)},canUseDynamicTimeAggregation:function(e){if(this.isChartSQLQuery()||e&&"SQLQUERY"===e.source){var t=this.getSqlBoxObject(e),i=["TIME","DATE"];return t&&this.hasSqlBoxZoom()&&_.any(t.columnsInQuery,(function(e){return new RegExp(i.join("|"),"i").test(e.basicType)||new RegExp(i.join("|"),"i").test(e.columnType)}))}return this.fields.hasTimeFields()},dynamicAggregateTime:function(e){var t="get";return _.isUndefined(e)||(t="set"),!!this[t]("commonConfig.isDynamicTimeAggregation",e)},toggleChartTypeTable:function(e,t){if((this.isChartNumber()||this.isChartGauge()||this.isChartText())&&!t)return!0;var i=this.get("generationConfig.backupType");e?i="table":this.has("generationConfig.backupType")&&this.unset("generationConfig.backupType",{silent:!0}),i&&this.get("generationConfig.type")!==i&&this.set({"generationConfig.backupType":this.getChartType(),"generationConfig.isDynamicTypeTable":e,"generationConfig.type":i})},setChartTypeToTable:function(e){if(this.isChartNumber()||this.isChartGauge()||this.isChartText())return!0;var t;e?"table"!==this.get("generationConfig.type")&&(this.backupType=this.get("generationConfig.type"),t="table"):t=this.backupType,t&&this.set({"generationConfig.isDynamicTypeTable":e,"generationConfig.type":t})},getSeriesMaxZIndex:function(){var e=_.max(this.get("data.series"),(function(e,t){return e.zIndex})),t=_.size(this.get("data.series"));return e=e&&e.zIndex||t,_.isFinite(e)?e:t},setSeriesType:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&"Default"!==t?(this.set(e+".chartType",t),this.set(e+".zIndex",this.getSeriesMaxZIndex()+1+1e3)):(this.unset(e+".chartType"),this.unset(e+".zIndex"))},drillDownChartIds:function(e,t,i,a){i=i||this.get("dashboard.id"),a=a||this.get("tabId");var s="/dashboards/".concat(i,"/tabs/").concat(a,"/charts/").concat(this.id,"/chartdrilldown"),o={success:function(e){},error:function(e){}};return e&&((o={data:e}).requestType=t?"PUT":"POST"),n.ajaxOrg(s,_.deepClone(o))},fetch:function(e){return e=e||{},this.gizmoModel&&this.gizmoModel.get("isContainer")&&(e.additionalUrlValues=e.additionalUrlValues||{},e.additionalUrlValues.isContainer=!0),Backbone.Model.prototype.fetch.call(this,e)},fetchDrilldowns:function(e,t,i){e=e||{},_.extend(e,{requestType:"GET"}),this.gizmoModel&&this.gizmoModel.get("isContainer")&&(e.additionalUrlValues=e.additionalUrlValues||{},e.additionalUrlValues.isContainer=!0),t=t||this.get("dashboard.id"),i=i||this.get("tabId");var a="/dashboards/".concat(t,"/tabs/").concat(i,"/charts/").concat(this.id,"/chartdrilldown");return n.ajaxOrg(a,_.deepClone(e))},hasActiveTimeFields:function(){var e=this.get("generationConfig.activeTimeFields");return!(!e||!e.length)},hasMetrics:function(){return this.fields.any((function(e){return e.isMetric()}))},clearChartCache:function(){var e=this.get("dashboard").id,t=this.get("tabId"),i=$.Deferred();if(e&&t)return n.ajaxOrg("/dashboard/"+e+"/tabs/"+t+"/chart/"+this.id+"/cache",{type:"DELETE",success:function(){i.resolve()},error:function(){i.resolve()}}),i;i.resolve()},getGroupFields:function(e){if(e){var t=this.getXYGroups(e);return t?t.get("fields"):[]}var i=[];this.fields.each((function(e){var t=e.get("origin");if("filters"!==t&&"groups"!==t){var n=this.getXYGroups(e);n&&i.push(n.get("fields"))}}),this);return _.flatten(i)},getSqlBoxAxisColumns:function(e){var t=_.deepClone(this.getSqlBoxObject()),i=t[e]||[],n=_.deep(this,"sqlResponseData.connectionsMap")||{},a=t.connectionsMap||{},s=[],o=[],r=_.union(Object.keys(n),Object.keys(a)),l={};_.each(r,(function(e){l[e]=_.union(n[e],a[e])})),_.isEmpty(l)||(this.isChartTable()?_.each(l,(function(e,t){_.isEmpty(e)||(s.push({axisName:t,axisColumns:e}),o=_.union(o,e))})):_.each(i,(function(e){var t=l[e];_.isEmpty(t)||(s.push({axisName:e,axisColumns:t}),o=_.union(o,t))})));var d=_.indexBy(t.columnsInQuery,"id");return _.each(s,(function(e){e.axisColumns=_.map(_.filter(e.axisColumns,(function(e){return d.hasOwnProperty(e)})),(function(t){return d[t].queryName=e.axisName,d[t]}))}),this),_.sortBy(_.filter(t.columnsInQuery,(function(e){var t=_.contains(o,e.id);return t&&(e.origin="dimensions"),t})),(function(e){return _.indexOf(o,e.id)}))},normalizeTextAndNumberStyles:function(){var e=this.has("style")?this.get("style"):this.get("data"),t={};return _.each(["fontFamily","fontRelativeSize","fontColor","backgroundColor","strokeColor","fontIsBold","fontIsItalic","fontIsUnderline","alignment","fontColorTrendNegative","fontColorTrendNeutral","fontColorTrendPositive","boxShadowColor","boxShadowShape","boxShadowStroke","boxShadowAngle","borderStroke","bubbleSize"],(function(i){e[i]&&(t[i]=e[i])})),t},togglePreviousConfig:function(e,t){if(_.isBoolean(e)&&this.set("generationConfig.previousConfig.enabled",!!e),t){var i=this.get("generationConfig.previousConfig");_.extend(i,t),this.set("generationConfig.previousConfig",i)}this.fields.each((function(i){if(i.isMeasure()){var n=i.get("previousConfig")||{};_.isBoolean(e)&&(!e&&!i.has("previousConfig")||t||i.set("previousConfig.enabled",!!e)),t&&(_.extend(n,t),i.set("previousConfig",n))}}))},setConditionalFormatting:function(e){this.set(this.isChartTable()?"commonConfig.tableConditionalFormatting":"commonConfig.conditionalformatting",e||{})}})}.apply(t,n))||(e.exports=a)}}]);